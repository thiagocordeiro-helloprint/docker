version: '3'
services:
    ### auth service
    fpm-auth:
        container_name: fpm-auth
        image: devilbox/php-fpm-7.4:latest
        volumes:
            - ./auth:/var/www/html
            - .docker/.bashrc:/root/.bashrc
        build:
            context: .docker/php

    nginx-auth:
        container_name: nginx-auth
        image: nginx
        volumes:
            - .docker/nginx-auth.conf:/etc/nginx/conf.d/default.conf
            - .docker/.bashrc:/root/.bashrc
        links:
            - fpm-auth
        ports:
            - 8000:8000

    ### api service
    fpm-api:
        container_name: fpm-api
        image: devilbox/php-fpm-7.4:latest
        depends_on:
            - nginx-auth
        volumes:
            - ./api:/var/www/html
            - .docker/.bashrc:/root/.bashrc
        build:
            context: .docker/php

    nginx-api:
        container_name: nginx-api
        image: nginx
        volumes:
            - .docker/nginx-api.conf:/etc/nginx/conf.d/default.conf
            - .docker/.bashrc:/root/.bashrc
        links:
            - fpm-api
        ports:
            - 8001:8001

    nginx-frontend:
        container_name: nginx-frontend
        image: nginx
        volumes:
            - ./frontend:/var/www/html
            - .docker/nginx-frontend.conf:/etc/nginx/conf.d/default.conf
            - .docker/.bashrc:/root/.bashrc
        ports:
            - 8008:8008
